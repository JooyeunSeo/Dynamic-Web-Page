{% extends 'base.html' %}
{% block title %}
  {% if current_user.is_authenticated %}
    To-do List of {{ current_user.name }}
  {% else %}
    Make your own to-do list
  {% endif %}
{% endblock %}

{% block content %}
<!-- ë“œë¡­ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ë³€ê²½ -->
<style>
  select {
    all: unset;
    appearance: auto;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 6px 10px 6px;
    font-size: 1rem;
    width: auto;
    color: black;
  }

  .important-icon.active {
    color: gold;
    content: "â˜…";
}
</style>

<script>
  const checkbox = document.getElementById("is_important");
  const toggle = document.getElementById("important-toggle");

  toggle.addEventListener("click", function () {
    toggle.classList.toggle("active");
    toggle.innerText = toggle.classList.contains("active") ? "â˜…" : "â˜†";
    checkbox.checked = toggle.classList.contains("active");
  });

  if (checkbox.checked) {
    toggle.classList.add("active");
    toggle.innerText = "â˜…";
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>


<div id="main">
  <div class="inner">
    <!-- ì œëª© -->
    {% if current_user.is_authenticated %}
	  <h1>To-do List of {{ current_user.name }}</h1>
    {% else %}
      <h1>Log in to use the service!</h1>
    {% endif %}

    <!-- task ì¶”ê°€ -->
    {% if current_user.is_authenticated %}
      <h2>â• Add new task</h2>

        <form method="POST" class="row g-3">
            {{ form.hidden_tag() }}
            <!-- í•  ì¼ ì…ë ¥ -->
            <div class="col-md-6">
                {{ form.text(class="form-control", rows="2") }}
            </div>
            <!-- ì¤‘ìš”ë„ ì„ íƒ -->
            <div class="col-md-2">
                {{ form.is_important }}
                <span id="important-toggle" class="important-icon" style="cursor:pointer; font-size: 1.5rem;">â˜†</span>
            </div>
            <!-- ê¸°í•œ ì„¤ì • -->
            <div class="col-md-3">
                {{ form.due_date(class="form-control form-control-sm", style="border-radius: 5px; padding: 1px;", placeholder="YYYY-MM-DD HH:MM") }}
            </div>
            <!-- ì œì¶œ ë²„íŠ¼ -->
            <div class="col-md-1">
                {{ form.submit(class="button small") }}
            </div>
        </form>

    {% else %}
      <a href="{{ url_for('login') }}">ë¡œê·¸ì¸í•˜ëŸ¬ ê°€ê¸°</a>
    {% endif %}


    <!-- ì§„í–‰ ì¤‘ì¸ task ë¦¬ìŠ¤íŠ¸ -->
    {% if current_user.is_authenticated %}
        {% if pending_tasks %}
            <form method="POST" action="{{ url_for('todo_list_home') }}">
                {{ form.hidden_tag() }}  <!-- CSRF token ì¶”ê°€ -->

                <div id="task-list">
                  {% for task in pending_tasks %}
                    <div class="task-item d-flex align-items-center" data-id="{{ task.id }}">
                      <span class="handle me-2" style="cursor: move;">â˜°</span>
                      <!-- ì²´í¬ë°•ìŠ¤ -->
                      {{ form.is_done() }}{{ form.is_done.label }}
                      <p>{{ task.text }} - ë§ˆê°: {{ task.due_date }}</p>
                    </div>
                  {% endfor %}
                </div>

                <button type="submit" class="btn btn-primary">Update Tasks</button>
            </form>
         {% else %}
             <p>í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
         {% endif %}
    {% else %}
        <p>ë¡œê·¸ì¸í•˜ë©´ ë‚˜ë§Œì˜ í•  ì¼ ëª©ë¡ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.</p>
    {% endif %}


    <!-- ì™„ë£Œí•œ task ë¦¬ìŠ¤íŠ¸ -->
    <h3>âœ… ì™„ë£Œí•œ ì‘ì—…</h3>
    {% if current_user.is_authenticated %}
        {% if completed_tasks %}
            <ul>
                {% for task in completed_tasks %}
                    <li style="text-decoration: line-through;">{{ task.text }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>ì•„ì§ ì™„ë£Œí•œ ì¼ì´ ì—†ì–´ìš”.</p>
        {% endif %}
    {% else %}
        <p>ë¡œê·¸ì¸í•˜ë©´ ë‚˜ë§Œì˜ í•  ì¼ ëª©ë¡ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.</p>
    {% endif %}


    <!-- task ë¦¬ìŠ¤íŠ¸ -->
    <h3>ğŸ—‘ï¸ ê¸°í•œì´ ì§€ë‚œ ì‘ì—…</h3>
    {% if current_user.is_authenticated %}
        {% if overdue_tasks %}
            <ul>
                {% for task in overdue_tasks %}
                    <li style="color: red;">{{ task.text }} - ë§ˆê°: {{ task.due_date }} (ê¸°í•œ ì´ˆê³¼)</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>ì§€ê°í•œ ì‘ì—…ì€ ì—†ìŠµë‹ˆë‹¤. ë‹¤í–‰ì´ë„¤ìš”!</p>
       {% endif %}
    {% else %}
        <p>ë¡œê·¸ì¸í•˜ë©´ ë‚˜ë§Œì˜ í•  ì¼ ëª©ë¡ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.</p>
    {% endif %}


  </div>
</div>
{% endblock %}